<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>20-10 Chúc Bạn</title>

<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

<style>
/* cơ bản */
body, html {
    margin: 0; padding: 0;
    font-family: 'Quicksand', sans-serif;
    background: #fff0f5;
    overflow-x: hidden;
}

.wrap { position: relative; z-index: 0; }

header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
}
header .logo { font-size: 24px; font-weight: bold; color: #ff9aa2; }
header h1 { margin: 0; font-size: 1.4rem; color: #7a3b5b; }
header .lead { font-size: 0.85rem; color: #bfa6c1; }

.main { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; padding: 8px; }

.left { flex: 1; min-width: 280px; max-width: 480px; }

.stage-card {
    background: #fff;
    padding: 12px 14px;
    border-radius: 14px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.controls { margin-top: 12px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
.btn {
    padding: 6px 14px; border-radius: 8px; cursor: pointer;
    border: none; font-size: 0.85rem;
}
.btn.primary { background: #ff9aa2; color: #fff; }
.btn.ghost { background: #fff; color: #ff9aa2; border:1px solid #ff9aa2; }

.envelope-wrap { display: flex; justify-content: center; margin-top: 12px; }
.envelope {
    width: 180px; max-width: 40vw; height: 120px;
    background: #ffe6ee; border-radius: 8px;
    position: relative; cursor: pointer; perspective: 500px;
}
#envFlap {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 50%;
    background: #ffbcd6;
    border-radius: 8px 8px 0 0;
    transform-origin: top;
    transition: transform 0.8s;
}
.env-body {
    position: absolute; top: 50%;
    width: 100%; height: 50%;
    background: #fff6f6;
    border-radius: 0 0 8px 8px;
    display: flex; align-items: center; justify-content: center;
    text-align: center; font-size: 0.85rem; padding: 6px;
}

footer.small { font-size: 13px; color: #bfa6c1; margin-top: 12px; text-align: center; }

#leaves {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none; z-index: 1;
}

/* crown hearts */
#crown { position: absolute; top: 0; left: 0; width: 100%; height: 0; z-index: 5; }

/* modal */
.modal {
    position: fixed; inset: 0;
    display: grid; place-items: center;
    background: rgba(3,3,10,0.7);
    z-index: 120; opacity: 0; pointer-events: none;
    transition: all .28s;
}
.modal.show { opacity: 1; pointer-events: auto; }
.modal-card { 
    background: linear-gradient(180deg,#fff,#fff8fb);
    color: #222;
    padding: 22px; border-radius: 14px;
    max-width: 480px; width: 94%;
    box-shadow: 0 40px 120px rgba(0,0,0,0.6);
    position: relative;
}
.modal-close { position: absolute; top: 12px; right: 14px; font-size: 18px; cursor: pointer; }

.letter-content { display: flex; gap: 14px; align-items: flex-start; flex-wrap: wrap; }
.letter-art { width: 100px; flex-shrink: 0; }
.typed {
    white-space: pre-wrap; font-family: 'Pacifico','Quicksand', cursive;
    font-size: 1rem; line-height: 1.5; color: #222;
    min-height: 160px; padding: 12px 12px 12px 18px;
    border-radius: 10px; box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    background: rgba(255,255,255,0.03); overflow-wrap: break-word;
}

/* sparkles */
.sparkle { position: absolute; width: 6px; height: 6px; border-radius:50%; background: radial-gradient(circle,#fff6,#ffd166); filter: blur(8px); opacity: .9; z-index: 10; }

/* falling flowers/hearts */
.falling-flower { font-size: 1.4rem; pointer-events: none; will-change: top, opacity; position: absolute; }

/* tree scene */
.scene { flex: 1; min-width: 220px; max-width: 320px; position: relative; }

/* responsive mobile */
@media(max-width:600px){
    .modal-card { width: 96vw; padding: 16px; }
    .typed { font-size: 0.9rem; line-height: 1.4; min-height: 120px; padding: 8px 10px 8px 14px; }
    .letter-art { width: 80px; }
    .env-body { font-size: 0.75rem; }
    .envelope { width: 36vw; height: 100px; }
}
</style>
</head>
<body>
<div class="wrap">
    <header>
        <div class="logo">20</div>
        <div>
            <h1>20-10 chúc bạn nhé</h1>
            <div class="lead">đọc nhé &amp; huyhuy</div>
        </div>
    </header>

    <div class="main">
        <div class="left">
            <div class="stage-card">
                <div class="intro">
                    <div style="display:flex;align-items:center;gap:14px;">
                        <div id="heartBtn" class="heart-btn pulse">❤️</div>
                        <div>
                            <div style="font-weight:800;font-size:18px">Nhấn trái tim để bắt đầu hành trình</div>
                            <div class="hint">chúc Khánh Ly nhé</div>
                        </div>
                    </div>

                    <div class="controls">
                        <button id="openNow" class="btn primary">Mở thư ngay</button>
                        <button id="muteBtn" class="btn ghost">Tắt nhạc</button>
                    </div>

                    <div class="envelope-wrap">
                        <div id="envelope" class="envelope" title="Nhấn để mở">
                            <div class="env-flap" id="envFlap"></div>
                            <div class="env-body">
                                Nhấn trái tim để mở lời chúc dành cho em...
                            </div>
                        </div>
                    </div>

                    <div style="margin-top:12px;color:#d9cfe6">
                        Chạm vào phong thư nữa để xem lời chúc – &amp; con nhợn
                    </div>
                </div>

                <footer class="small"></footer>
            </div>
        </div>

        <div class="scene">
            <div class="tree-stage" id="treeStage">
                <div class="trunk"></div>
                <div class="root"></div>
                <div class="crown" id="crown"></div>
                <div id="treeFlowers" style="position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;"></div>
            </div>
        </div>
    </div>
</div>

<!-- audio -->
<audio id="bgm" src="music/noinaycoanh.mp3" preload="auto"></audio>
<canvas id="leaves"></canvas>

<!-- modal letter -->
<div class="modal" id="modal">
    <div class="modal-card">
        <div class="modal-close" id="closeModal">✕</div>
        <div class="letter-content">
            <div class="letter-art">
                <svg viewBox="0 0 200 200" width="100%" xmlns="http://www.w3.org/2000/svg">
                    <rect x="12" y="38" rx="8" ry="8" width="176" height="120" fill="#fff6f6" stroke="#ffdede"/>
                    <path d="M12 38 L100 110 L188 38" fill="#ffdfe6"/>
                </svg>
            </div>
            <div class="typed" id="typedText"></div>
        </div>
        <div style="text-align:right;margin-top:14px">
            <button class="btn primary" id="closeBtn">Đã đọc</button>
        </div>
    </div>
</div>

<script>
// --- Crown ---
(function buildCrown() {
    const crown = document.getElementById('crown');
    const positions = [
        [20,10,1.2,30],[40,6,1.6,350],[60,8,1.4,10],[80,4,1.9,340],[100,6,1.5,20],[120,12,1.4,15],[140,10,1.3,330],
        [30,28,1.2,15],[50,26,1.6,350],[70,24,1.7,12],[90,22,1.4,10],[110,24,1.5,320],[130,26,1.2,345],[150,24,1.3,5]
    ];
    positions.forEach((p,i)=>{
        const el=document.createElement('div'); el.className='heart'+(i%3===0?' glow':'');
        el.style.left=p[0]+'%'; el.style.top=p[1]+'%';
        const size=36*p[2]; el.style.width=size+'px'; el.style.height=size*0.92+'px';
        el.style.transform='rotate('+p[3]+'deg)';
        const span=document.createElement('div');
        span.style.fontSize=Math.floor(size*0.75)+'px';
        span.style.lineHeight=(size*0.92)+'px';
        span.style.textAlign='center';
        span.textContent='❤';
        el.appendChild(span); crown.appendChild(el);
        el.animate([{transform:el.style.transform+' translateY(0px)'},{transform:el.style.transform+' translateY(-8px)'},{transform:el.style.transform+' translateY(0px)'}],{duration:3500+Math.random()*2500,iterations:Infinity,easing:'ease-in-out'});
    });
})();

// --- Falling leaves ---
(function leaves() {
    const canvas=document.getElementById('leaves'); const ctx=canvas.getContext('2d');
    let W=canvas.width=window.innerWidth; let H=canvas.height=window.innerHeight;
    window.addEventListener('resize',()=>{W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;});
    const particles=[];
    function create(){const x=Math.random()*W;const size=6+Math.random()*26;particles.push({x:x,y:-20,vy:1+Math.random()*2,vx:-0.6+Math.random()*1.2,size:size,rot:Math.random()*360,rotV:(Math.random()-0.5)*0.04,color:['#ff9aa2','#ffd166','#ffd6e0','#ffb997'][Math.floor(Math.random()*4)]});}
    for(let i=0;i<28;i++) create();
    function loop(){ctx.clearRect(0,0,W,H);if(Math.random()<0.08) create();for(let i=particles.length-1;i>=0;i--){const p=particles[i];p.x+=p.vx;p.y+=p.vy;p.rot+=p.rotV;ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot);ctx.fillStyle=p.color;ctx.beginPath();ctx.ellipse(0,0,p.size*0.6,p.size,0,0,Math.PI*2);ctx.fill();ctx.restore();if(p.y>H+40||p.x<-80||p.x>W+80)particles.splice(i,1);}requestAnimationFrame(loop);}
    loop();
})();

// --- Envelope & letter ---
const env=document.getElementById('envelope'); const flap=document.getElementById('envFlap'); const modal=document.getElementById('modal'); const typedText=document.getElementById('typedText'); const bgm=document.getElementById('bgm'); const heartBtn=document.getElementById('heartBtn'); const openNow=document.getElementById('openNow'); const muteBtn=document.getElementById('muteBtn'); const closeModal=document.getElementById('closeModal'); const closeBtn=document.getElementById('closeBtn');
let isOpen=false;
const message=`Gửi Khánh Ly – gấu đây!\n\n20-10 không có gì để tặng, nên tui làm cái này gửi cho bạn.\nChúc Khánh Ly luôn mạnh khỏe, bình an, hạnh phúc.\n\nCó thể sau này… hết giận tui nhen.  \nKhi nào tui có tiền tui dẫn đi ăn gà gà nhé!\n\nVui lên hí hí, đừng ghét tui nhiều nữa.  \nLuôn nhẹ nhàng với nhau nha.\n\nKhánh Ly giúp tui nhiều lắm, tui biết ơn ghê á.  \nKhông muốn mọi thứ như bây giờ chút nào…\n\nCũng mong là… thời gian trôi qua, Khánh Ly sẽ bớt ghét tui.  \nVà gửi thật nhiều điều tốt đẹp đến mẹ Lợi nữa nha!\n\n– Gửi từ một người vẫn thương bạn nhiều lắm –`;
function typeWriter(text,el,speed=24){el.textContent='';let i=0;function step(){if(i<text.length){el.textContent+=text.charAt(i);i++;setTimeout(step,speed);}}step();}
function openEnvelope(){if(isOpen)return;isOpen=true;flap.style.transform='rotateX(180deg) translateY(-6px)';flap.style.transition='transform .8s ease';env.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}],{duration:450});setTimeout(()=>{modal.classList.add('show');bgm.muted=false;bgm.currentTime=0;bgm.play().catch(()=>{});typeWriter(message,typedText,26);},900);}
env.addEventListener('click',openEnvelope); heartBtn.addEventListener('click',()=>{openEnvelope();}); openNow.addEventListener('click',()=>{openEnvelope(); window.scrollTo({top:0,behavior:'smooth'});}); muteBtn.addEventListener('click',()=>{bgm.muted=!bgm.muted; muteBtn.textContent=bgm.muted?'Bật nhạc':'Tắt nhạc';}); closeModal.addEventListener('click',()=>{modal.classList.remove('show');}); closeBtn.addEventListener('click',()=>{modal.classList.remove('show'); bgm.pause();}); document.addEventListener('keydown',(e)=>{if(e.key==='Enter')openEnvelope();});

// sparkles
(function sparkles(){const wrap=document.querySelector('.wrap');for(let i=0;i<8;i++){const s=document.createElement('div');s.className='sparkle';s.style.left=Math.random()*90+'%';s.style.top=Math.random()*60+'%';s.style.width=4+Math.random()*10+'px';s.style.height=s.style.width;wrap.appendChild(s);s.animate([{opacity:0.2,transform:'scale(.8)'},{opacity:1,transform:'scale(1.2)'},{opacity:0.2,transform:'scale(.8)'}],{duration:2000+Math.random()*3000,iterations:Infinity});}})();

// tree flowers
let treeFlowerInterval=null;
function createTreeFlower(){const treeFlowers=document.getElementById('treeFlowers');if(!treeFlowers)return;for(let i=0;i<8;i++){const el=document.createElement('div');el.className='falling-flower';el.style.left=Math.random()*180+'px';el.style.top='-30px';el.style.position='absolute';el.style.width=el.style.height=(16+Math.random()*18)+'px';el.style.opacity=0.8+Math.random()*0.2;el.innerHTML=Math.random()>0.5?'🌸':'❤';treeFlowers.appendChild(el);setTimeout(()=>{el.style.top=(260+Math.random()*40)+'px';el.style.opacity=0.1;},100);setTimeout(()=>{el.remove();},3000);}}
function startTreeFlower(){if(treeFlowerInterval)return; treeFlowerInterval=setInterval(createTreeFlower,700);}
function stopTreeFlower(){clearInterval(treeFlowerInterval); treeFlowerInterval=null;}
document.getElementById('modal').addEventListener('transitionend',function(e){if(document.getElementById('modal').classList.contains('show')){startTreeFlower();}else{stopTreeFlower();const treeFlowers=document.getElementById('treeFlowers');if(treeFlowers)treeFlowers.innerHTML='';}});
document.getElementById('closeBtn').addEventListener('click',stopTreeFlower);
document.getElementById('closeModal').addEventListener('click',stopTreeFlower);
</script>
</body>
</html>

