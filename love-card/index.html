<!doctype html>
<html lang="vi">

<head>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Thiệp 20/10 - Love Tree Card</title>
    <style>
        /* RESET */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        html,
        body {
            height: 100%
        }

        body {
            font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            background: linear-gradient(180deg, #0b0e1a 0%, #241426 60%);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px
        }

        /* Stage */
        .typed {
            white-space: pre-wrap;
            font-family: 'Pacifico', 'Quicksand', 'Segoe Script', 'Comic Sans MS', cursive, sans-serif;
            font-size: 1.38rem;
            line-height: 2.1;
            color: #222;
            text-shadow: 0 2px 12px #fff, 0 0px 2px #fff, 0 0 8px #f9d6c1;
            min-height: 200px;
            max-height: 320px;
            background: rgba(255, 255, 255, 0.10);
            border-radius: 14px;
            padding: 22px 22px 22px 32px;
            margin: 0 0 8px 0;
            box-shadow: 0 4px 24px rgba(255, 255, 255, 0.12), 0 2px 12px rgba(0, 0, 0, 0.08);
            text-align: left;
            border: 2px solid #fffbe6;
            overflow-y: auto;
        }

        .logo {
            width: 64px;
            height: 64px;
            border-radius: 14px;
            background: linear-gradient(135deg, #ff6b81, #ff9aa2);
            display: grid;
            place-items: center;
            font-weight: 800;
            color: #fff
        }

        h1 {
            font-size: 20px
        }

        .lead {
            color: #d9cfe6
        }

        .main {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 20px;
            margin-top: 18px;
            align-items: start
        }

        @media(max-width:980px) {
            .main {
                grid-template-columns: 1fr
            }
        }

        /* LEFT: envelope & controls */
        .left {
            padding: 12px
        }

        .stage-card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(0, 0, 0, 0.05));
            border-radius: 14px;
            padding: 18px;
            min-height: 520px;
            position: relative
        }

        .intro {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: flex-start
        }

        .heart-btn {
            font-size: 84px;
            cursor: pointer;
            user-select: none;
            filter: drop-shadow(0 12px 30px rgba(255, 90, 120, 0.14));
            transition: transform .18s
        }

        .heart-btn.pulse {
            animation: pulse 1.6s infinite
        }

        @keyframes pulse {
            0% {
                transform: scale(1)
            }

            50% {
                transform: scale(1.05)
            }

            100% {
                transform: scale(1)
            }
        }

        .hint {
            color: #e9deef
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 8px
        }

        .btn {
            padding: 10px 16px;
            border-radius: 999px;
            border: 0;
            cursor: pointer;
            font-weight: 700
        }

        .btn.primary {
            background: linear-gradient(90deg, #ff6b81, #ff9aa2);
            color: #fff
        }

        .btn.ghost {
            background: transparent;
            color: #e7dfea;
            border: 1px solid rgba(255, 255, 255, 0.06)
        }

        /* envelope */
        .envelope-wrap {
            width: 340px;
            height: 220px;
            margin-top: 18px;
            display: grid;
            place-items: center
        }

        .envelope {
            width: 320px;
            height: 200px;
            border-radius: 12px;
            background: linear-gradient(180deg, #fff, #fff8fb);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.45)
        }

        .env-flap {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            height: 60%;
            background: linear-gradient(135deg, #ff9aa2, #ff6b81);
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            transform-origin: top center;
            transition: transform .6s ease
        }

        .env-body {
            position: absolute;
            left: 12px;
            right: 12px;
            bottom: 14px;
            top: 48px;
            background: linear-gradient(180deg, #fff, #fffaf0);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px
        }

        .env-letter {
            width: 88%;
            height: 80%;
            background: linear-gradient(180deg, #fffefc, #fff8f6);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            padding: 12px;
            font-family: Georgia, serif
        }

        /* RIGHT: scene - tree & girl rendered by code */
        .scene {
            position: relative;
            padding: 12px
        }

        .tree-stage {
            width: 100%;
            height: 540px;
            position: relative;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.06));
            border-radius: 12px;
            overflow: hidden
        }

        /* tree trunk using CSS */
        .trunk {
            position: absolute;
            left: 36%;
            bottom: 26%;
            width: 60px;
            height: 160px;
            background: linear-gradient(180deg, #6b3b2b, #3a2016);
            border-radius: 28px 28px 8px 8px;
            transform: skewX(-6deg);
            box-shadow: inset 0 -20px 40px rgba(0, 0, 0, 0.25)
        }

        .root {
            position: absolute;
            left: 28%;
            bottom: 8%;
            width: 200px;
            height: 90px;
            border-radius: 50px;
            background: linear-gradient(180deg, #3a2016, #24130b);
            filter: blur(10px);
            opacity: .6
        }

        /* crown as many hearts placed absolutely */
        .crown {
            position: absolute;
            left: 8%;
            right: 8%;
            top: 6%;
            bottom: 48%;
            pointer-events: none
        }

        .heart {
            position: absolute;
            width: 48px;
            height: 44px;
            transform-origin: center;
            transition: transform .3s ease;
            filter: drop-shadow(0 12px 26px rgba(255, 90, 120, 0.12))
        }

        .heart:before {
            content: '❤';
            display: block;
            font-size: 36px;
            line-height: 44px;
            text-align: center;
            color: #ff4d6d
        }

        /* glowing hearts */
        .heart.glow:before {
            color: #fff5;
            text-shadow: 0 0 12px rgba(255, 150, 150, 0.95)
        }

        /* girl vector - drawn with SVG for crispness */
        .girl-svg {
            position: absolute;
            left: 10%;
            bottom: 6%;
            width: 240px;
            height: auto;
            filter: drop-shadow(0 20px 50px rgba(0, 0, 0, 0.5))
        }

        /* leaves falling layer - canvas */
        #leaves {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 45
        }

        /* modal letter open */
        .modal {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            background: linear-gradient(rgba(3, 3, 10, 0.7), rgba(3, 3, 10, 0.7));
            z-index: 120;
            opacity: 0;
            pointer-events: none;
            transition: all .28s
        }

        .modal.show {
            opacity: 1;
            pointer-events: auto
        }

        .modal-card {
            background: linear-gradient(180deg, #fff, #fff8fb);
            color: #222;
            padding: 26px;
            border-radius: 14px;
            max-width: 900px;
            width: 94%;
            box-shadow: 0 40px 120px rgba(0, 0, 0, 0.6);
            position: relative
        }

        .modal-close {
            position: absolute;
            right: 14px;
            top: 12px;
            cursor: pointer;
            font-size: 18px
        }

        .letter-content {
            display: flex;
            gap: 18px;
            align-items: flex-start
        }

        .letter-art {
            width: 280px
        }

        .typed {
            white-space: pre-wrap;
            font-family: 'Pacifico', 'Quicksand', 'Segoe Script', 'Comic Sans MS', cursive, sans-serif;
            font-size: 1.32rem;
            line-height: 1.9;
            color: #222;
            min-height: 200px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 18px 18px 18px 28px;
            margin: 0 0 8px 0;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            text-align: left;
        }

        /* small footer */
        footer.small {
            font-size: 13px;
            color: #bfa6c1;
            margin-top: 12px;
            text-align: center
        }

        /* animations for subtle sparkle */
        .sparkle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: radial-gradient(circle, #fff6, #ffd166);
            filter: blur(8px);
            opacity: .9
        }

        .falling-flower {
            font-size: 1.6rem;
            pointer-events: none;
            will-change: top, opacity;
            z-index: 2;
        }

        .romantic-flex {
            display: flex;
            gap: 32px;
            align-items: flex-start;
            justify-content: center;
        }

        .romantic-tree {
            min-width: 240px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .romantic-letter {
            flex: 1;
            min-width: 320px;
            max-width: 480px;
        }

        .romantic-modal {
            max-width: 900px;
            width: 96vw;
            background: linear-gradient(120deg, #f9e6ff 0%, #fff6f6 100%);
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.18);
            border-radius: 24px;
            padding: 32px 38px 32px 38px;
            position: relative;
        }

        @media (max-width: 600px) {
            .romantic-tree #flowerTree {
                width: 140px !important;
                height: 180px !important;
            }

            .romantic-tree #flowerTree>div[style*='position:absolute'] {
                width: 110px !important;
                height: 80px !important;
                top: 92% !important;
                left: 50% !important;
                transform: translate(-50%, 0);
            }

            .romantic-tree #flowerTree img {
                border-radius: 18px !important;
                box-shadow: 0 6px 24px #0002, 0 2px 8px #ffd6e0 !important;
            }

            .romantic-letter {
                min-width: 0 !important;
                max-width: 98vw !important;
                padding: 0 !important;
            }

            .typed {
                font-size: 1.02rem !important;
                line-height: 1.5 !important;
                padding: 12px 8px 12px 12px !important;
                min-height: 120px !important;
                max-height: 180px !important;
            }

            .letter-art {
                width: 120px !important;
                margin-bottom: 8px !important;
            }

            .letter-girl-art {
                margin-top: 10px !important;
            }

            .romantic-modal {
                padding: 16px 6vw 16px 6vw !important;
                border-radius: 14px !important;
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header>
            <div class="logo">20</div>
            <div>
                <h1>20-10 chúc bạn nhé</h1>
                <div class="lead">đọc nhé &amp; huyhuy</div>
            </div>
        </header>

        <div class="main">
            <div class="left">
                <div class="stage-card">
                    <div class="intro">
                        <div style="display:flex;align-items:center;gap:14px;">
                            <div id="heartBtn" class="heart-btn pulse">❤️</div>
                            <div>
                                <div style="font-weight:800;font-size:18px">Nhấn trái tim để bắt đầu hành trình</div>
                                <div class="hint">chúc khánh ly nhé</div>
                            </div>
                        </div>

                        <div class="controls">
                            <button id="openNow" class="btn primary">Mở thư ngay</button>
                            <button id="muteBtn" class="btn ghost">Tắt nhạc</button>
                        </div>

                        <div class="envelope-wrap">
                            <div id="envelope" class="envelope" title="Nhấn để mở">
                                <div class="env-flap" id="envFlap"></div>
                                <div class="env-body">
                                    <div class="env-letter"> Nhn trái tim để mở lời chúc dành cho em...</div>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top:12px;color:#d9cfe6">Chạm vào phong thư nữa để xem lời chúc –
                            &amp; con nhợn </div>
                    </div>

                    <footer class="small">
                    </footer>
                </div>
            </div>

            <div class="scene">
                <div class="tree-stage" id="treeStage">
                    <div class="trunk"></div>
                    <div class="root"></div>
                    <div class="crown" id="crown"></div>

                    <!-- girl inserted as SVG (no external image) -->
                    <svg class="girl-svg" viewBox="0 0 200 260" xmlns="http://www.w3.org/2000/svg">
                        <!-- simplified cute anime girl vector -->
                        <defs>
                            <linearGradient id="hair" x1="0" x2="1">
                                <stop offset="0" stop-color="#b56b8a" />
                                <stop offset="1" stop-color="#7a3b5b" />
                            </linearGradient>
                            <linearGradient id="dress" x1="0" x2="1">
                                <stop offset="0" stop-color="#ffd6e0" />
                                <stop offset="1" stop-color="#ff9aa2" />
                            </linearGradient>
                        </defs>
                        <g transform="translate(20,10)">
                            <ellipse cx="80" cy="210" rx="58" ry="30" fill="#241217" opacity="0.15" />
                            <path d="M60 40 C58 20,102 20,100 40 C110 62,94 86,80 92 C66 86,50 62,60 40 Z"
                                fill="url(#hair)" />
                            <circle cx="80" cy="80" r="28" fill="#f9d6d9" />
                            <ellipse cx="70" cy="85" rx="6" ry="8" fill="#2b1b1f" />
                            <ellipse cx="90" cy="85" rx="6" ry="8" fill="#2b1b1f" />
                            <path d="M64 100 Q80 112 96 100" stroke="#b56b8a" stroke-width="2" fill="none"
                                stroke-linecap="round" />
                            <path d="M50 110 C60 155,100 155,110 110 L110 180 C100 200,60 200,50 180 Z"
                                fill="url(#dress)" />
                        </g>
                    </svg>

                </div>
            </div>
        </div>

    </div>

    <!-- modal letter -->
    <div class="modal" id="modal">
        <div class="modal-card romantic-modal">
            <div class="modal-close" id="closeModal">✕</div>
            <div class="romantic-flex">
                <div class="romantic-tree">
                    <div id="flowerTree" style="width:220px;height:320px;position:relative;">
                        <svg id="treeSVG" width="220" height="320" viewBox="0 0 220 320" xmlns="http://www.w3.org/2000/svg">
                            <!-- Thân cây -->
                            <rect x="100" y="120" width="20" height="120" rx="10" fill="#8d5c2b" />
                            <!-- Tán cây -->
                            <ellipse cx="110" cy="90" rx="80" ry="60" fill="#e6caff" />
                            <ellipse cx="60" cy="70" rx="32" ry="24" fill="#ffd6e0" />
                            <ellipse cx="160" cy="70" rx="32" ry="24" fill="#ffd6e0" />
                            <ellipse cx="110" cy="40" rx="40" ry="28" fill="#ffd166" />
                            <!-- Hoa lớn -->
                            <circle cx="60" cy="120" r="12" fill="#ff9aa2" />
                            <circle cx="160" cy="120" r="12" fill="#ff9aa2" />
                            <circle cx="110" cy="70" r="14" fill="#ffd6e0" />
                            <circle cx="110" cy="110" r="10" fill="#ffd166" />
                            <!-- Hoa nhỏ -->
                            <circle cx="80" cy="60" r="6" fill="#fff" />
                            <circle cx="140" cy="60" r="6" fill="#fff" />
                            <circle cx="90" cy="100" r="5" fill="#ffd6e0" />
                            <circle cx="130" cy="100" r="5" fill="#ffd6e0" />
                            <!-- Trái tim -->
                            <path d="M110 60 Q120 40 130 60 Q120 80 110 60 Z" fill="#ff9aa2" />
                            <path d="M80 80 Q90 60 100 80 Q90 100 80 80 Z" fill="#ff9aa2" />
                            <path d="M140 80 Q150 60 160 80 Q150 100 140 80 Z" fill="#ff9aa2" />
                        </svg>
                        <div id="treeFlowers" style="position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;"></div>
                        <div style="position:absolute;left:50%;top:92%;transform:translate(-50%,0);width:200px;height:140px;">
                           
                        </div>
                    </div>
                </div>
                <div class="romantic-letter">
                    <div class="letter-art">
                        <svg viewBox="0 0 200 200" width="100%" xmlns="http://www.w3.org/2000/svg">
                            <rect x="12" y="38" rx="8" ry="8" width="176" height="120" fill="#fff6f6" stroke="#ffdede" />
                            <path d="M12 38 L100 110 L188 38" fill="#ffdfe6" />
                        </svg>
                    </div>
                    <div class="typed" id="typedText"></div>
                    <div class="letter-girl-art" style="display:flex;justify-content:center;margin-top:18px;">
                        <svg width="110" height="150" viewBox="0 0 110 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <ellipse cx="55" cy="60" rx="32" ry="36" fill="#ffe0e0" />
                            <ellipse cx="55" cy="52" rx="36" ry="38" fill="#b57ba6" />
                            <ellipse cx="55" cy="38" rx="18" ry="12" fill="#b57ba6" />
                            <ellipse cx="40" cy="70" rx="6" ry="3" fill="#f9b3b3" />
                            <ellipse cx="70" cy="70" rx="6" ry="3" fill="#f9b3b3" />
                            <ellipse cx="43" cy="60" rx="4" ry="7" fill="#3a2b2b" />
                            <ellipse cx="67" cy="60" rx="4" ry="7" fill="#3a2b2b" />
                            <path d="M48 78 Q55 84 62 78" stroke="#e07a7a" stroke-width="2" fill="none" stroke-linecap="round" />
                            <ellipse cx="55" cy="110" rx="22" ry="28" fill="#ffd6e0" />
                            <ellipse cx="30" cy="110" rx="7" ry="18" fill="#ffe0e0" transform="rotate(-18 30 110)" />
                            <ellipse cx="80" cy="110" rx="7" ry="18" fill="#ffe0e0" transform="rotate(18 80 110)" />
                            <rect x="46" y="135" width="6" height="12" rx="3" fill="#f9b3b3" />
                            <rect x="58" y="135" width="6" height="12" rx="3" fill="#f9b3b3" />
                        </svg>
                    </div>
                </div>
            </div>
            <div style="text-align:right;margin-top:14px"><button class="btn primary" id="closeBtn">Đã đọc</button>
            </div>
        </div>
    </div>

    <!-- audio -->
    <audio id="bgm" src="/music/Nơi Này Có Anh.mp3" preload="auto"></audio>

    <canvas id="leaves" width="800" height="600"></canvas>

    <script>
        // --- Build heart crown by code ---
        (function buildCrown() {
            const crown = document.getElementById('crown');
            const positions = [
                [20, 10, 1.2, 30], [40, 6, 1.6, 350], [60, 8, 1.4, 10], [80, 4, 1.9, 340], [100, 6, 1.5, 20], [120, 12, 1.4, 15], [140, 10, 1.3, 330],
                [30, 28, 1.2, 15], [50, 26, 1.6, 350], [70, 24, 1.7, 12], [90, 22, 1.4, 10], [110, 24, 1.5, 320], [130, 26, 1.2, 345], [150, 24, 1.3, 5]
            ];
            positions.forEach((p, i) => {
                const el = document.createElement('div');
                el.className = 'heart' + (i % 3 === 0 ? ' glow' : '');
                el.style.left = p[0] + '%';
                el.style.top = p[1] + '%';
                const size = (36 * p[2]);
                el.style.width = size + 'px';
                el.style.height = (size * 0.92) + 'px';
                el.style.transform = 'rotate(' + p[3] + 'deg)';
                // create inner symbol
                const span = document.createElement('div');
                span.style.fontSize = Math.floor(size * 0.75) + 'px';
                span.style.lineHeight = (size * 0.92) + 'px';
                span.style.textAlign = 'center';
                span.textContent = '❤';
                el.appendChild(span);
                crown.appendChild(el);
                // small float animation
                el.animate([
                    { transform: el.style.transform + ' translateY(0px) ' },
                    { transform: el.style.transform + ' translateY(-8px) ' },
                    { transform: el.style.transform + ' translateY(0px) ' }
                ], { duration: 3500 + Math.random() * 2500, iterations: Infinity, easing: 'ease-in-out' });
            });
        })();

        // --- Falling leaves/hearts using canvas ---
        (function leaves() {
            const canvas = document.getElementById('leaves');
            const ctx = canvas.getContext('2d');
            let W = canvas.width = window.innerWidth;
            let H = canvas.height = window.innerHeight;
            window.addEventListener('resize', () => { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight });

            const particles = [];
            function create() {
                const x = Math.random() * W;
                const size = 6 + Math.random() * 26;
                particles.push({ x: x, y: -20, vy: 1 + Math.random() * 2, vx: -0.6 + Math.random() * 1.2, size: size, rot: Math.random() * 360, rotV: (Math.random() - 0.5) * 0.04, color: ['#ff9aa2', '#ffd166', '#ffd6e0', '#ffb997'][Math.floor(Math.random() * 4)] });
            }
            for (let i = 0; i < 28; i++) create();
            function loop() {
                ctx.clearRect(0, 0, W, H);
                if (Math.random() < 0.08) create();
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx; p.y += p.vy; p.rot += p.rotV;
                    ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
                    // draw heart-like leaf
                    ctx.fillStyle = p.color;
                    ctx.beginPath(); ctx.ellipse(0, 0, p.size * 0.6, p.size, 0, 0, Math.PI * 2); ctx.fill();
                    ctx.restore();
                    if (p.y > H + 40 || p.x < -80 || p.x > W + 80) particles.splice(i, 1);
                }
                requestAnimationFrame(loop);
            }
            loop();
        })();

        // --- Envelope open + modal typed letter ---
        const env = document.getElementById('envelope');
        const flap = document.getElementById('envFlap');
        const modal = document.getElementById('modal');
        const typedText = document.getElementById('typedText');
        const bgm = document.getElementById('bgm');
        const heartBtn = document.getElementById('heartBtn');
        const openNow = document.getElementById('openNow');
        const muteBtn = document.getElementById('muteBtn');
        const closeModal = document.getElementById('closeModal');
        const closeBtn = document.getElementById('closeBtn');

        let isOpen = false;
        // message
    const message = `Gửi Khánh Ly – gấu đây!\n\n20-10 không có gì để tặng, nên tui làm cái này gửi cho bạn.\nChúc Khánh Ly luôn mạnh khỏe, bình an, hạnh phúc.\n\nCó thể sau này… hết giận tui nhen.  \nKhi nào tui có tiền tui dẫn đi ăn gà gà nhé!\n\nVui lên hí hí, đừng ghét tui nhiều nữa.  \nLuôn nhẹ nhàng với nhau nha.\n\nKhánh Ly giúp tui nhiều lắm, tui biết ơn ghê á.  \nKhông muốn mọi thứ như bây giờ chút nào…\n\nCũng mong là… thời gian trôi qua, Khánh Ly sẽ bớt ghét tui.  \nVà gửi thật nhiều điều tốt đẹp đến mẹ Lợi nữa nha!\n\n– Gửi từ một người vẫn thương bạn nhiều lắm –`;

        function typeWriter(text, el, speed = 24) { el.textContent = ''; let i = 0; function step() { if (i < text.length) { el.textContent += text.charAt(i); i++; setTimeout(step, speed); } } step(); }

        function openEnvelope() {
            if (isOpen) return; isOpen = true; flap.style.transform = 'rotateX(180deg) translateY(-6px)'; flap.style.transition = 'transform .8s ease';
            env.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.02)' }, { transform: 'scale(1)' }], { duration: 450 });
            setTimeout(() => {
                modal.classList.add('show');
                bgm.muted = false;
                bgm.currentTime = 0;
                bgm.play().catch(() => { });
                typeWriter(message, typedText, 26);
            }, 900);
        }

        env.addEventListener('click', openEnvelope);
        heartBtn.addEventListener('click', () => { openEnvelope(); });
        openNow.addEventListener('click', () => { openEnvelope(); window.scrollTo({ top: 0, behavior: 'smooth' }); });
        muteBtn.addEventListener('click', () => { bgm.muted = !bgm.muted; muteBtn.textContent = bgm.muted ? 'Bật nhạc' : 'Tắt nhạc' });
        closeModal.addEventListener('click', () => { modal.classList.remove('show'); });
        closeBtn.addEventListener('click', () => { modal.classList.remove('show'); bgm.pause(); });

        // small random sparkles
        (function sparkles() {
            const wrap = document.querySelector('.wrap');
            for (let i = 0; i < 8; i++) {
                const s = document.createElement('div'); s.className = 'sparkle'; s.style.left = Math.random() * 90 + '%'; s.style.top = Math.random() * 60 + '%'; s.style.width = 4 + Math.random() * 10 + 'px'; s.style.height = s.style.width; wrap.appendChild(s);
                s.animate([{ opacity: 0.2, transform: 'scale(.8)' }, { opacity: 1, transform: 'scale(1.2)' }, { opacity: 0.2, transform: 'scale(.8)' }], { duration: 2000 + Math.random() * 3000, iterations: Infinity });
            }
        })();

        // accessibility: allow keyboard enter to open
        document.addEventListener('keydown', (e) => { if (e.key === 'Enter') openEnvelope(); });

        // Hiệu ứng hoa/trái tim rơi quanh cây khi modal mở
let treeFlowerInterval = null;
function createTreeFlower() {
  const treeFlowers = document.getElementById('treeFlowers');
  if (!treeFlowers) return;
  for (let i = 0; i < 8; i++) {
    const el = document.createElement('div');
    el.className = 'falling-flower';
    el.style.left = Math.random() * 180 + 'px';
    el.style.top = '-30px';
    el.style.position = 'absolute';
    el.style.width = el.style.height = (16 + Math.random() * 18) + 'px';
    el.style.opacity = 0.8 + Math.random() * 0.2;
    el.style.transition = 'top 2.8s linear, opacity 2.8s linear';
    el.innerHTML = Math.random() > 0.5 ? '🌸' : '❤';
    treeFlowers.appendChild(el);
    setTimeout(() => {
      el.style.top = (260 + Math.random() * 40) + 'px';
      el.style.opacity = 0.1;
    }, 100);
    setTimeout(() => { el.remove(); }, 3000);
  }
}
function startTreeFlower() {
  if (treeFlowerInterval) return;
  treeFlowerInterval = setInterval(createTreeFlower, 700);
}
function stopTreeFlower() {
  clearInterval(treeFlowerInterval);
  treeFlowerInterval = null;
}
document.getElementById('modal').addEventListener('transitionend', function(e) {
  if (document.getElementById('modal').classList.contains('show')) {
    startTreeFlower();
  } else {
    stopTreeFlower();
    const treeFlowers = document.getElementById('treeFlowers');
    if (treeFlowers) treeFlowers.innerHTML = '';
  }
});
document.getElementById('closeBtn').addEventListener('click', stopTreeFlower);
document.getElementById('closeModal').addEventListener('click', stopTreeFlower);
    </script>
</body>

</html>
